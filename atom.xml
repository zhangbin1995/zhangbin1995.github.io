<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HeroBin&#39;s Blog</title>
  
  <subtitle>向阳而生</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.herobin.top/"/>
  <updated>2019-05-19T14:29:48.350Z</updated>
  <id>http://www.herobin.top/</id>
  
  <author>
    <name>HeroBin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【置顶】博客迁移至CSDN</title>
    <link href="http://www.herobin.top/2019/05/19/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E8%87%B3CSDN/"/>
    <id>http://www.herobin.top/2019/05/19/博客迁移至CSDN/</id>
    <published>2019-05-19T14:28:08.000Z</published>
    <updated>2019-05-19T14:29:48.350Z</updated>
    
    <content type="html"><![CDATA[<p>博客迁移至csdn，后续更新将主要在csdn中进行。欢迎关注：</p><ul><li><a href="https://blog.csdn.net/qq_24095055" target="_blank" rel="noopener">进击的Z同学</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;博客迁移至csdn，后续更新将主要在csdn中进行。欢迎关注：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/qq_24095055&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;进击的Z同学&lt;/a&gt;&lt;/li&gt;
&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>【置顶】消息中间件专题</title>
    <link href="http://www.herobin.top/2019/05/19/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%93%E9%A2%98/"/>
    <id>http://www.herobin.top/2019/05/19/消息中间件专题/</id>
    <published>2019-05-19T13:51:27.000Z</published>
    <updated>2019-05-19T14:27:17.614Z</updated>
    
    <content type="html"><![CDATA[<h1 id="消息中间件专题汇总"><a href="#消息中间件专题汇总" class="headerlink" title="消息中间件专题汇总"></a>消息中间件专题汇总</h1><table><thead><tr><th>目录</th><th>博客链接</th></tr></thead><tbody><tr><td>消息中间件基础</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88974751" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Mac下ActiveMQ的下载与安装</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88974051" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>mac安装启动RabbitMQ</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88993147" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>RabbitMQ消息中间件基础概念入门</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88998542" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>RabbitMQ整合SpringBoot2.x</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89017142" target="_blank" rel="noopener">点击跳转</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;消息中间件专题汇总&quot;&gt;&lt;a href=&quot;#消息中间件专题汇总&quot; class=&quot;headerlink&quot; title=&quot;消息中间件专题汇总&quot;&gt;&lt;/a&gt;消息中间件专题汇总&lt;/h1&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;目录&lt;/th&gt;
&lt;th&gt;博客链接&lt;/th
      
    
    </summary>
    
      <category term="MQ" scheme="http://www.herobin.top/categories/MQ/"/>
    
    
      <category term="MQ" scheme="http://www.herobin.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>【置顶】SpringBoot专题</title>
    <link href="http://www.herobin.top/2019/05/19/Spring%20Boot%20%E4%B8%93%E9%A2%98/"/>
    <id>http://www.herobin.top/2019/05/19/Spring Boot 专题/</id>
    <published>2019-05-19T13:48:41.000Z</published>
    <updated>2019-05-19T13:50:53.599Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot-专题"><a href="#Spring-Boot-专题" class="headerlink" title="Spring Boot 专题"></a>Spring Boot 专题</h1><table><thead><tr><th>目录</th><th>博客链接</th></tr></thead><tbody><tr><td>两小时学会SpringBoot</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90290614" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>设置IDEA可以启动多个Spring Boot程序</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90293425" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>SpringBoot Profile多环境配置</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89089167" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Spring Boot启动流程</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89098786" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>springboot集成dubbo环境搭建</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88086775" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>springboot集成zookeeper注册中心</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88089452" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>springboot集成jpa自动创建更新时间</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/86711263" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>springboot使用lombok省略set和get方法</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/86712042" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Spring Boot面试题整理</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88749291" target="_blank" rel="noopener">点击跳转</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Boot-专题&quot;&gt;&lt;a href=&quot;#Spring-Boot-专题&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot 专题&quot;&gt;&lt;/a&gt;Spring Boot 专题&lt;/h1&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="springboot" scheme="http://www.herobin.top/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>【置顶】SpringCloud学习笔记</title>
    <link href="http://www.herobin.top/2019/05/19/SpringCloud%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://www.herobin.top/2019/05/19/SpringCloud学习笔记/</id>
    <published>2019-05-19T13:45:34.000Z</published>
    <updated>2019-05-19T13:47:27.908Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>目录</th><th>博客链接</th></tr></thead><tbody><tr><td>SpringCloud简介</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90299036" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>SpringCloud学习笔记 - eureka注册中心</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89843051" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>SpringCloud服务发现 - eureka使用及高可用配置</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90312528" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>SpringCloud服务发现 - consul</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90312986" target="_blank" rel="noopener">点击跳转</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;目录&lt;/th&gt;
&lt;th&gt;博客链接&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;SpringCloud简介&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://blog.csdn.net/qq_2409
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="springcloud" scheme="http://www.herobin.top/tags/springcloud/"/>
    
  </entry>
  
  <entry>
    <title>【置顶】Java面试归纳总结</title>
    <link href="http://www.herobin.top/2019/05/19/Java%E9%9D%A2%E8%AF%95%E5%BD%92%E7%BA%B3%E6%80%BB%E7%BB%93/"/>
    <id>http://www.herobin.top/2019/05/19/Java面试归纳总结/</id>
    <published>2019-05-19T13:40:33.000Z</published>
    <updated>2019-05-19T13:44:53.939Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java面试总结"><a href="#Java面试总结" class="headerlink" title="Java面试总结"></a>Java面试总结</h1><table><thead><tr><th>分类</th><th>链接</th></tr></thead><tbody><tr><td>Java面试之基础篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88530106" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之集合篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88547339" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之多线程篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88550739" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之JVM篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88573407" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之框架篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88663201" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之数据库篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/90267186" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java知识体系之Redis篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89394558" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之分布式专题</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88757944" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之数据结构篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88593724" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之算法篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88969907" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之设计模式篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88690826" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之计算机网络篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89889107" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之操作系统篇</td><td></td></tr><tr><td>Java面试之真实面试经历篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88530158" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之附加篇</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88688810" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之优化专题</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88970861" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java面试之场景题汇总</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/89517949" target="_blank" rel="noopener">点击跳转</a></td></tr></tbody></table><p>持续更新中…</p><p>跳转均为本人csdn博客地址，后续也将以csdn为主，欢迎关注^_^</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java面试总结&quot;&gt;&lt;a href=&quot;#Java面试总结&quot; class=&quot;headerlink&quot; title=&quot;Java面试总结&quot;&gt;&lt;/a&gt;Java面试总结&lt;/h1&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;分类&lt;/th&gt;
&lt;th&gt;链接&lt;/th&gt;
&lt;/tr
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="java" scheme="http://www.herobin.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>线程池技术及其示例</title>
    <link href="http://www.herobin.top/2019/05/19/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E7%A4%BA%E4%BE%8B/"/>
    <id>http://www.herobin.top/2019/05/19/线程池技术及其示例/</id>
    <published>2019-05-19T13:35:56.000Z</published>
    <updated>2019-05-19T13:39:01.454Z</updated>
    
    <content type="html"><![CDATA[<h1 id="线程池技术及其示例"><a href="#线程池技术及其示例" class="headerlink" title="线程池技术及其示例"></a>线程池技术及其示例</h1><p>对于服务端的程序，经常面对成千上万的任务提交到服务器汇总，如果采用一个任务一个线程的方式，那么将会创建数以万计的线程，这不是一个好的选择。因为这会使操作系统频繁的进行线程上下文切换，无故增加系统的负载，而线程的创建和消亡都是需要耗费系统资源的，也无疑浪费了系统资源。</p><p>线程池技术能够很好的解决这个问题，它预先创建了若干数量的线程，并且不能由用户直接对线程的创建进行控制，在这个前提下重复使用固定或较为固定数目的线程来完成任务的执行。这样做的好处是，一方面，消除了频繁创建和消亡线程的系统资源开销，另一方面，面对过量任务的提交能够平缓的劣化。</p><p>下面是一个简单的线程池接口定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ThreadPool</span>&lt;<span class="title">Job</span> <span class="keyword">extends</span> <span class="title">Runnable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 执行一个Job，这个Job需要实现Runnable</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Job job)</span></span>;</span><br><span class="line">    <span class="comment">// 关闭线程池</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 增加工作者线程</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addWorkers</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">    <span class="comment">// 减少工作者线程</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeWorker</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">    <span class="comment">// 得到正在等待执行的任务数量</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getJobSize</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端可以通过execute(Job)方法将Job提交入线程池执行，而客户端自身不用等待Job的执行完成。除了execute(Job)方法以外，线程池接口提供了增大/减少工作者线程以及关闭线程池的方法。这里工作者线程代表着一个重复执行Job的线程，而每个由客户端提交的Job都将进入到一个工作队列中等待工作者线程的处理。</p><p>下面是线程池接口的默认实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultThreadPool</span>&lt;<span class="title">Job</span> <span class="keyword">extends</span> <span class="title">Runnable</span>&gt; <span class="keyword">implements</span> <span class="title">ThreadPool</span>&lt;<span class="title">Job</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程池最大限制数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_WORKER_NUMBER = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 线程池默认的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_WORKER_NUMBERS = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 线程池最小的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_WORKER_NUMBERS = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 这是一个工作队列，将会向里面插入工作</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedList&lt;Job&gt; jobs = <span class="keyword">new</span> LinkedList&lt;Job&gt;();</span><br><span class="line">    <span class="comment">// 工作者列表  Woker是自定义的。。。在最后面</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Worker&gt; workers = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;Worker&gt;());</span><br><span class="line">    <span class="comment">// 工作者线程的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> workerNum = DEFAULT_WORKER_NUMBERS;</span><br><span class="line">    <span class="comment">// 线程编号生成</span></span><br><span class="line">    <span class="keyword">private</span> AtomicLong threadNum = <span class="keyword">new</span> AtomicLong();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        initialWorkers(DEFAULT_WORKER_NUMBERS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultThreadPool</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        workerNum = num &gt; MAX_WORKER_NUMBER ? MAX_WORKER_NUMBER : num &lt; MIN_WORKER_NUMBERS ? MIN_WORKER_NUMBERS : num;</span><br><span class="line">        initialWorkers(workerNum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化线程工作者</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialWorkers</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; num ; i ++)&#123;</span><br><span class="line">            Worker worker = <span class="keyword">new</span> Worker();</span><br><span class="line">            workers.add(worker);</span><br><span class="line">            <span class="comment">// 一个工作者对应一个线程  worker &lt;-&gt; thread  用来执行Job</span></span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(worker, <span class="string">"ThreadPool-Worker-"</span> + threadNum.incrementAndGet());</span><br><span class="line">            thread.start();</span><br><span class="line">            workers.add(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Job job)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (job != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 添加一个工作，然后进行通知</span></span><br><span class="line">            <span class="keyword">synchronized</span> (jobs)&#123;</span><br><span class="line">                jobs.addLast(job);</span><br><span class="line">                jobs.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Worker worker : workers)&#123;</span><br><span class="line">            <span class="comment">// 可以理解为停止每个线程</span></span><br><span class="line">            worker.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addWorkers</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (jobs)&#123;</span><br><span class="line">            <span class="comment">// 限制新增的Worker数量不能超过最大值</span></span><br><span class="line">            <span class="keyword">if</span> (num + <span class="keyword">this</span>.workerNum &gt; MAX_WORKER_NUMBER)&#123;</span><br><span class="line">                num = MAX_WORKER_NUMBER - <span class="keyword">this</span>.workerNum;</span><br><span class="line">            &#125;</span><br><span class="line">            initialWorkers(num);</span><br><span class="line">            <span class="keyword">this</span>.workerNum += num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeWorker</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (jobs)&#123;</span><br><span class="line">            <span class="keyword">if</span> (num &gt;= <span class="keyword">this</span>.workerNum)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"beyond workNum"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 按照给定的数量停止 Worker</span></span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; num)&#123;</span><br><span class="line">                Worker worker = workers.get(count);</span><br><span class="line">                <span class="keyword">if</span> (workers.remove(worker))&#123;</span><br><span class="line">                    worker.shutdown();</span><br><span class="line">                    count ++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.workerNum -= count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getJobSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jobs.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工作者，负责消费任务</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 是否工作</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> running = <span class="keyword">true</span>;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (running)&#123;</span><br><span class="line">                Job job = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">synchronized</span> (jobs)&#123;</span><br><span class="line">                    <span class="comment">// 如果工作者列表是空的，那么就wait</span></span><br><span class="line">                    <span class="keyword">while</span> (jobs.isEmpty())&#123;</span><br><span class="line">                        <span class="keyword">try</span>&#123;</span><br><span class="line">                            jobs.wait();</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (InterruptedException ex)&#123;</span><br><span class="line">                            <span class="comment">// 感知到外部对WorkerThread的中断操作，返回</span></span><br><span class="line">                            Thread.currentThread().interrupt();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 取出一个Job</span></span><br><span class="line">                    job = jobs.removeFirst();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (job != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        job.run();</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">                        <span class="comment">// 忽略 Job 执行中的 Exception</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>&#123;</span><br><span class="line">            running = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类编写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadPool tp = <span class="keyword">new</span> DefaultThreadPool();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; count ; i++)&#123;</span><br><span class="line">            tp.execute(<span class="keyword">new</span> Task(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Task"</span> + num + <span class="string">" running..."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep((<span class="keyword">int</span>)(Math.random()*<span class="number">5000</span>) + <span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Task0 running...</span><br><span class="line">Task1 running...</span><br><span class="line">Task2 running...</span><br><span class="line">Task3 running...</span><br><span class="line">Task4 running...</span><br><span class="line">Task5 running... <span class="comment">// 从这开始是后面陆续出现的</span></span><br><span class="line">Task6 running...</span><br><span class="line">Task7 running...</span><br><span class="line">Task8 running...</span><br><span class="line">Task9 running...</span><br></pre></td></tr></table></figure><p>因为核心线程池大小默认是5，所以开始有五个执行，又我们在执行方法中设定了线程睡眠时间1-6秒范围，所以后面的五个是陆续执行的。</p><p>从线程的实现可以看到，当客户端调用execute(Job)方法时，会不断地向任务列表jobs中添加Job，而每个工作者线程会不断地从jobs上取出一个Job进行执行，当jobs为空时，工作者线程进入等待状态。</p><p>添加一个Job后，对工作队列jobs调用了其notify()方法，而不是notifyAll()方法，因为能够确定有工作者线程被唤醒，这时使用notify()方法将会比notifyAll()方法获得更小的开销（避免将等待队列中的线程全部移动到阻塞队列中）。</p><p>可以看到，线程池的本质就是使用了一个线程安全的工作队列连接工作者线程和客户端线程，客户端线程将任务放入工作队列后便返回，而工作者线程则不断地从工作队列上取出工作并执行。当工作队列为空时，所有的工作者线程均等待在工作队列上，当有客户端提交了一个任务之后会通知任意一个工作者线程，随着大量的任务被提交，更多的工作者线程会被唤醒。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;线程池技术及其示例&quot;&gt;&lt;a href=&quot;#线程池技术及其示例&quot; class=&quot;headerlink&quot; title=&quot;线程池技术及其示例&quot;&gt;&lt;/a&gt;线程池技术及其示例&lt;/h1&gt;&lt;p&gt;对于服务端的程序，经常面对成千上万的任务提交到服务器汇总，如果采用一个任务一个线程的
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="多线程" scheme="http://www.herobin.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Java中双检锁里volatile的作用</title>
    <link href="http://www.herobin.top/2019/05/19/Java%E4%B8%AD%E5%8F%8C%E6%A3%80%E9%94%81%E9%87%8Cvolatile%E7%9A%84%E4%BD%9C%E7%94%A8/"/>
    <id>http://www.herobin.top/2019/05/19/Java中双检锁里volatile的作用/</id>
    <published>2019-05-19T13:28:46.000Z</published>
    <updated>2019-05-19T13:35:08.450Z</updated>
    
    <content type="html"><![CDATA[<h1 id="懒汉式"><a href="#懒汉式" class="headerlink" title="懒汉式"></a>懒汉式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="饿汉式-线程安全"><a href="#饿汉式-线程安全" class="headerlink" title="饿汉式(线程安全)"></a>饿汉式(线程安全)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="双检锁-线程安全"><a href="#双检锁-线程安全" class="headerlink" title="双检锁(线程安全)"></a>双检锁(线程安全)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)&#123; <span class="comment">// 第一次检查</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) <span class="comment">// 第二次检查</span></span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Java中双检锁里volatile的作用"><a href="#Java中双检锁里volatile的作用" class="headerlink" title="Java中双检锁里volatile的作用"></a>Java中双检锁里volatile的作用</h1><p>双检锁中在第二次检查后创建对象的代码</p><p><code>instance = new Singleton();</code></p><p>可以分解为如下的3行伪代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory = allocate(); <span class="comment">// 1.分配对象的内存空间</span></span><br><span class="line">ctorInstance(memory); <span class="comment">// 2.初始化对象</span></span><br><span class="line">instance = memory; <span class="comment">// 3.设置instance指向刚分配的内存地址</span></span><br></pre></td></tr></table></figure><p>上面3行伪代码中的2和3之间，可能会被重排序。2和3之间重排序之后的执行时序如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory = allocate(); <span class="comment">// 1.分配对象的内存空间</span></span><br><span class="line">instance = memory; <span class="comment">// 3.设置instance指向刚分配的内存空间</span></span><br><span class="line">ctorInstance(memory); <span class="comment">// 2.初始化对象</span></span><br></pre></td></tr></table></figure><p>这样在多线程下可能会发生问题，即当线程A执行完里面的1、3过程时，线程B在判断出instance不为空就会直接访问instance引用的对象。此时，线程B将会访问一个还未初始化的对象。</p><p>当声明对象的引用为volatile后，3行伪代码中的2和3之间的重排序，在多线程环境下将会被禁止，保证了线程安全的延迟初始化。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;懒汉式&quot;&gt;&lt;a href=&quot;#懒汉式&quot; class=&quot;headerlink&quot; title=&quot;懒汉式&quot;&gt;&lt;/a&gt;懒汉式&lt;/h1&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;sp
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="多线程" scheme="http://www.herobin.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="设计模式" scheme="http://www.herobin.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java多线程-手写一个死锁的例子</title>
    <link href="http://www.herobin.top/2019/05/19/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81%E7%9A%84%E4%BE%8B%E5%AD%90/"/>
    <id>http://www.herobin.top/2019/05/19/Java多线程-手写一个死锁的例子/</id>
    <published>2019-05-19T13:23:54.000Z</published>
    <updated>2019-05-19T13:27:56.728Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java多线程-手写一个死锁的例子"><a href="#Java多线程-手写一个死锁的例子" class="headerlink" title="Java多线程-手写一个死锁的例子"></a>Java多线程-手写一个死锁的例子</h1><p>下面是一个多线程死锁的例子</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object lock1 = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object lock2 = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> DeadLockDemo().deadLock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deadLock</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock1)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"thread1 get lock1"</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">synchronized</span> (lock2)&#123;</span><br><span class="line">                        System.out.println(<span class="string">"thread1 get lock2"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"thread1 end"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock2)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"thread2 get lock2"</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">synchronized</span> (lock1)&#123;</span><br><span class="line">                        System.out.println(<span class="string">"thread2 get lock1"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"thread2 end"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread1 get lock1</span><br><span class="line">thread2 get lock2</span><br><span class="line"><span class="comment">// 后面无限期等待下去</span></span><br></pre></td></tr></table></figure><p>两个线程相互得到锁1，锁2，然后线程1等待线程2释放锁2，线程2等待线程1释放锁1，两者各不相互，这样形成死锁。</p><p>那么如何避免和解决死锁问题呢？</p><p>1、按顺序加锁</p><p>上个例子线程间加锁的顺序各不一致，导致死锁，如果每个线程都按同一个的加锁顺序这样就不会出现死锁。</p><p>2、获取锁时限</p><p>每个获取锁的时候加上个时限，如果超过某个时间就放弃获取锁之类的。</p><p>3、死锁检测</p><p>按线程间获取锁的关系检测线程间是否发生死锁，如果发生死锁就执行一定的策略，如终断线程或回滚操作等。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java多线程-手写一个死锁的例子&quot;&gt;&lt;a href=&quot;#Java多线程-手写一个死锁的例子&quot; class=&quot;headerlink&quot; title=&quot;Java多线程-手写一个死锁的例子&quot;&gt;&lt;/a&gt;Java多线程-手写一个死锁的例子&lt;/h1&gt;&lt;p&gt;下面是一个多线程死锁
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="多线程" scheme="http://www.herobin.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot启动流程</title>
    <link href="http://www.herobin.top/2019/05/19/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"/>
    <id>http://www.herobin.top/2019/05/19/SpringBoot启动流程/</id>
    <published>2019-05-19T12:07:13.000Z</published>
    <updated>2019-05-19T12:14:44.488Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot启动流程"><a href="#Spring-Boot启动流程" class="headerlink" title="Spring Boot启动流程"></a>Spring Boot启动流程</h1><p>springboot的自动配置为我们带来了方便快捷的开发体验，那么它的启动流程是怎样的呢？这里我们就来了解一下SpringBoot内部启动原理。</p><p>首先来看SpringBoot的启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里就有SpringBoot启动关键的两个部分</p><ul><li>@SpringBootApplication</li><li>SpringApplication.run</li></ul><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><p>点进@SpringBootApplication注解查看源码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringBootConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.TypeExcludeFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AliasFor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="line">), <span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="line">)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">    <span class="meta">@AliasFor</span>(</span><br><span class="line">        annotation = EnableAutoConfiguration.class,</span><br><span class="line">        attribute = <span class="string">"exclude"</span></span><br><span class="line">    )</span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(</span><br><span class="line">        annotation = EnableAutoConfiguration.class,</span><br><span class="line">        attribute = <span class="string">"excludeName"</span></span><br><span class="line">    )</span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(</span><br><span class="line">        annotation = ComponentScan.class,</span><br><span class="line">        attribute = <span class="string">"basePackages"</span></span><br><span class="line">    )</span><br><span class="line">    String[] scanBasePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(</span><br><span class="line">        annotation = ComponentScan.class,</span><br><span class="line">        attribute = <span class="string">"basePackageClasses"</span></span><br><span class="line">    )</span><br><span class="line">    Class&lt;?&gt;[] scanBasePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>虽然定义使用了多个Annotation进行了原信息标注，但实际重要的只有三个Annotation：</p><ul><li>@Configuration（@SpringBootConfiguration点开查看发现里面还是应用了@Configuration）</li><li>@EnableAutoConfiguration</li><li>@ComponentScan</li></ul><p>所以，如果我们使用如下的SpringBoot启动类，整个SpringBoot应用依然可以与之前的启动类功能对等：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，还是使用一个<code>@SpringBootApplication</code>更加方便快捷。</p><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>这里的@Configuration就是JavaConfig形式的Spring Ioc容器的配置类使用的那个@Configuration，SpringBoot社区推荐使用基于JavaConfig的配置形式，所以，这里的启动类标注了@Configuration之后，本身其实也是一个IoC容器的配置类。</p><h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><p>@ComponentScan这个注解在Spring中很重要，它对应XML配置中的元素，@ComponentScan的功能其实就是自动扫描并加载符合条件的组件（比如@Component和@Repository等）或者bean定义，最终将这些bean定义加载到IoC容器中。</p><p>我们可以通过basePackages等属性来细粒度的定制@ComponentScan自动扫描的范围，如果不指定，则默认Spring框架实现会从声明@ComponentScan所在类的package进行扫描。</p><blockquote><p>注：所以SpringBoot的启动类最好是放在root package下，因为默认不指定basePackages。</p></blockquote><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>个人感觉@EnableAutoConfiguration这个Annotation最为重要，所以放在最后来解读，大家是否还记得Spring框架提供的各种名字为@Enable开头的Annotation定义？比如@EnableScheduling、@EnableCaching、@EnableMBeanExport等，@EnableAutoConfiguration的理念和做事方式其实一脉相承，简单概括一下就是，借助@Import的支持，收集和注册特定场景相关的bean定义。<br>@EnableScheduling是通过@Import将Spring调度框架相关的bean定义都加载到IoC容器。<br>@EnableMBeanExport是通过@Import将JMX相关的bean定义加载到IoC容器。<br>而@EnableAutoConfiguration也是借助@Import的帮助，将所有符合自动配置条件的bean定义加载到IoC容器，仅此而已！<br>@EnableAutoConfiguration作为一个复合Annotation,其自身定义关键信息如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;EnableAutoConfigurationImportSelector.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，最关键的要属@Import(EnableAutoConfigurationImportSelector.class)，借助EnableAutoConfigurationImportSelector，@EnableAutoConfiguration可以帮助SpringBoot应用将所有符合条件的@Configuration配置都加载到当前SpringBoot创建并使用的IoC容器。<br>借助于Spring框架原有的一个工具类：SpringFactoriesLoader的支持，@EnableAutoConfiguration可以智能的自动配置功效才得以大功告成！</p><p>自动配置幕后英雄：SpringFactoriesLoader详解<br>SpringFactoriesLoader属于Spring框架私有的一种扩展方案，其主要功能就是从指定的配置文件META-INF/spring.factories加载配置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.core.io.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AnnotationAwareOrderComparator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.UrlResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ClassUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringFactoriesLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SpringFactoriesLoader.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FACTORIES_RESOURCE_LOCATION = <span class="string">"META-INF/spring.factories"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringFactoriesLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">loadFactories</span><span class="params">(Class&lt;T&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(factoryClass, <span class="string">"'factoryClass' must not be null"</span>);</span><br><span class="line">        ClassLoader classLoaderToUse = classLoader;</span><br><span class="line">        <span class="keyword">if</span>(classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; factoryNames = loadFactoryNames(factoryClass, classLoaderToUse);</span><br><span class="line">        <span class="keyword">if</span>(logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"Loaded ["</span> + factoryClass.getName() + <span class="string">"] names: "</span> + factoryNames);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; result = <span class="keyword">new</span> ArrayList(factoryNames.size());</span><br><span class="line">        Iterator var5 = factoryNames.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var5.hasNext()) &#123;</span><br><span class="line">            String factoryName = (String)var5.next();</span><br><span class="line">            result.add(instantiateFactory(factoryName, factoryClass, classLoaderToUse));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        AnnotationAwareOrderComparator.sort(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        String factoryClassName = factoryClass.getName();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span>?classLoader.getResources(<span class="string">"META-INF/spring.factories"</span>):ClassLoader.getSystemResources(<span class="string">"META-INF/spring.factories"</span>);</span><br><span class="line">            ArrayList result = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">                URL url = (URL)urls.nextElement();</span><br><span class="line">                Properties properties = PropertiesLoaderUtils.loadProperties(<span class="keyword">new</span> UrlResource(url));</span><br><span class="line">                String factoryClassNames = properties.getProperty(factoryClassName);</span><br><span class="line">                result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var8) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load ["</span> + factoryClass.getName() + <span class="string">"] factories from location ["</span> + <span class="string">"META-INF/spring.factories"</span> + <span class="string">"]"</span>, var8);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">instantiateFactory</span><span class="params">(String instanceClassName, Class&lt;T&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; instanceClass = ClassUtils.forName(instanceClassName, classLoader);</span><br><span class="line">            <span class="keyword">if</span>(!factoryClass.isAssignableFrom(instanceClass)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Class ["</span> + instanceClassName + <span class="string">"] is not assignable to ["</span> + factoryClass.getName() + <span class="string">"]"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Constructor&lt;?&gt; constructor = instanceClass.getDeclaredConstructor(<span class="keyword">new</span> Class[<span class="number">0</span>]);</span><br><span class="line">                ReflectionUtils.makeAccessible(constructor);</span><br><span class="line">                <span class="keyword">return</span> constructor.newInstance(<span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to instantiate factory class: "</span> + factoryClass.getName(), var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配合@EnableAutoConfiguration使用的话，它更多是提供一种配置查找的功能支持，即根据@EnableAutoConfiguration的完整类名org.springframework.boot.autoconfigure.EnableAutoConfiguration作为查找的Key,获取对应的一组@Configuration类</p><p>上图就是从SpringBoot的autoconfigure依赖包中的META-INF/spring.factories配置文件中摘录的一段内容，可以很好地说明问题。<br>所以，@EnableAutoConfiguration自动配置的魔法骑士就变成了：从classpath中搜寻所有的META-INF/spring.factories配置文件，并将其中org.springframework.boot.autoconfigure.EnableutoConfiguration对应的配置项通过反射（Java Refletion）实例化为对应的标注了@Configuration的JavaConfig形式的IoC容器配置类，然后汇总为一个并加载到IoC容器。</p><h2 id="深入探索SpringApplication执行流程"><a href="#深入探索SpringApplication执行流程" class="headerlink" title="深入探索SpringApplication执行流程"></a>深入探索SpringApplication执行流程</h2><p>SpringApplication的run方法的实现是我们本次旅程的主要线路，该方法的主要流程大体可以归纳如下：</p><ol><li><p>如果我们使用的是SpringApplication的静态run方法，那么，这个方法里面首先要创建一个SpringApplication对象实例，然后调用这个创建好的SpringApplication的实例方法。在SpringApplication实例初始化的时候，它会提前做几件事情：<br>根据classpath里面是否存在某个特征类（org.springframework.web.context.ConfigurableWebApplicationContext）来决定是否应该创建一个为Web应用使用的ApplicationContext类型。<br>使用SpringFactoriesLoader在应用的classpath中查找并加载所有可用的ApplicationContextInitializer。<br>使用SpringFactoriesLoader在应用的classpath中查找并加载所有可用的ApplicationListener。<br>推断并设置main方法的定义类。</p></li><li><p>SpringApplication实例初始化完成并且完成设置后，就开始执行run方法的逻辑了，方法执行伊始，首先遍历执行所有通过SpringFactoriesLoader可以查找到并加载的SpringApplicationRunListener。调用它们的started()方法，告诉这些SpringApplicationRunListener，“嘿，SpringBoot应用要开始执行咯！”。</p></li><li><p>创建并配置当前Spring Boot应用将要使用的Environment（包括配置要使用的PropertySource以及Profile）。</p></li><li>遍历调用所有SpringApplicationRunListener的environmentPrepared()的方法，告诉他们：“当前SpringBoot应用使用的Environment准备好了咯！”。</li><li>如果SpringApplication的showBanner属性被设置为true，则打印banner。</li><li>根据用户是否明确设置了applicationContextClass类型以及初始化阶段的推断结果，决定该为当前SpringBoot应用创建什么类型的ApplicationContext并创建完成，然后根据条件决定是否添加ShutdownHook，决定是否使用自定义的BeanNameGenerator，决定是否使用自定义的ResourceLoader，当然，最重要的，将之前准备好的Environment设置给创建好的ApplicationContext使用。</li><li>ApplicationContext创建好之后，SpringApplication会再次借助Spring-FactoriesLoader，查找并加载classpath中所有可用的ApplicationContext-Initializer，然后遍历调用这些ApplicationContextInitializer的initialize（applicationContext）方法来对已经创建好的ApplicationContext进行进一步的处理。</li><li>遍历调用所有SpringApplicationRunListener的contextPrepared()方法。</li><li>最核心的一步，将之前通过@EnableAutoConfiguration获取的所有配置以及其他形式的IoC容器配置加载到已经准备完毕的ApplicationContext。</li><li>遍历调用所有SpringApplicationRunListener的contextLoaded()方法。</li><li>调用ApplicationContext的refresh()方法，完成IoC容器可用的最后一道工序。</li><li>查找当前ApplicationContext中是否注册有CommandLineRunner，如果有，则遍历执行它们。</li><li>正常情况下，遍历执行SpringApplicationRunListener的finished()方法、（如果整个过程出现异常，则依然调用所有SpringApplicationRunListener的finished()方法，只不过这种情况下会将异常信息一并传入处理）<br>去除事件通知点后，整个流程如下：</li></ol><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>到此，SpringBoot的核心组件完成了基本的解析，综合来看，大部分都是Spring框架背后的一些概念和实践方式，SpringBoot只是在这些概念和实践上对特定的场景事先进行了固化和升华，而也恰恰是这些固化让我们开发基于Sping框架的应用更加方便高效。</p><p><a href="http://tengj.top/2017/03/09/springboot3/" target="_blank" rel="noopener">http://tengj.top/2017/03/09/springboot3/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Boot启动流程&quot;&gt;&lt;a href=&quot;#Spring-Boot启动流程&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot启动流程&quot;&gt;&lt;/a&gt;Spring Boot启动流程&lt;/h1&gt;&lt;p&gt;springboot的自动配置为我们
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="springboot" scheme="http://www.herobin.top/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot Profile 多环境配置</title>
    <link href="http://www.herobin.top/2019/05/19/SpringBootProfile%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://www.herobin.top/2019/05/19/SpringBootProfile多环境配置/</id>
    <published>2019-05-19T11:57:56.000Z</published>
    <updated>2019-05-19T12:00:42.377Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot-Profile-多环境配置"><a href="#SpringBoot-Profile-多环境配置" class="headerlink" title="SpringBoot Profile 多环境配置"></a>SpringBoot Profile 多环境配置</h1><p>应用程序通常需要在多环境下运行，如开发环境，测试环境，生产环境，一些配置细节通常会有所不同，最简单的比如日志，生产日志会将日志级别设置为<code>WARN</code>或更高级别，并将日志写入日志文件，而开发的时候需要日志级别为<code>DEBUG</code>，日志输出到控制台即可。</p><p>这就需要我们每次在不用的环境下部署时都要修改对应的配置，SpringBoot的Profile提供了多环境配置帮我们将更换环境配置变得简单。</p><p>在<code>Spring Boot</code>中多环境配置文件名需要满足<code>application-{profile}.properties/yml</code>的格式，其中<code>{profile}</code>对应你的环境标识，比如：</p><ul><li><p><code>application-dev.properties/application-dev.yml</code>：开发环境</p></li><li><p><code>application-prod.properties/application-prod.yml</code>：生产环境</p></li><li><code>application-test.properties/application-test.yml</code>：测试环境</li></ul><p>想要使用对应的环境，只需要在<code>application.properties/application.yml</code>中使用<code>spring.profiles.active</code>属性来设置，值对应上面提到的<code>{profile}</code>，这里就是指<code>dev</code>、<code>prod</code>、和<code>test</code>这三个。</p><p>给不同的环境添加不同的端口属性<code>server.port</code>，然后根据指定不同的<code>spring.profiles.active</code>来切换使用。</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0519-01/1.png" alt="在这里插入图片描述"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SpringBoot-Profile-多环境配置&quot;&gt;&lt;a href=&quot;#SpringBoot-Profile-多环境配置&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot Profile 多环境配置&quot;&gt;&lt;/a&gt;SpringBoot Pro
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="springboot" scheme="http://www.herobin.top/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>idea java类文件左下角出现红色的J标识解决办法</title>
    <link href="http://www.herobin.top/2019/05/19/java%E7%B1%BB%E6%96%87%E4%BB%B6%E5%B7%A6%E4%B8%8B%E8%A7%92%E5%87%BA%E7%8E%B0%E7%BA%A2%E8%89%B2%E7%9A%84J%E6%A0%87%E8%AF%86%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>http://www.herobin.top/2019/05/19/java类文件左下角出现红色的J标识解决办法/</id>
    <published>2019-05-19T11:52:37.000Z</published>
    <updated>2019-05-19T11:56:02.181Z</updated>
    
    <content type="html"><![CDATA[<p>IDEA java类文件左下角出现红色的J标识,且方法无法执行,考虑应该是未编译的结果.如图:<br><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0519-01/1.png" alt="在这里插入图片描述"></p><p>解决办法：</p><p>File&gt;&gt;project structure&gt;&gt;Modules</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0519-01/2.png" alt="在这里插入图片描述"></p><p>在项目或src路径上标识Sources，问题解决。</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0519-01/3.png" alt="在这里插入图片描述"></p><p>原文博客：<a href="https://blog.csdn.net/jielinku29/article/details/79678467" target="_blank" rel="noopener">https://blog.csdn.net/jielinku29/article/details/79678467</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;IDEA java类文件左下角出现红色的J标识,且方法无法执行,考虑应该是未编译的结果.如图:&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0
      
    
    </summary>
    
      <category term="报错" scheme="http://www.herobin.top/categories/%E6%8A%A5%E9%94%99/"/>
    
    
      <category term="报错" scheme="http://www.herobin.top/tags/%E6%8A%A5%E9%94%99/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ整合SpringBoot2.x</title>
    <link href="http://www.herobin.top/2019/05/17/RabbitMQ%E6%95%B4%E5%90%88SpringBoot2-x/"/>
    <id>http://www.herobin.top/2019/05/17/RabbitMQ整合SpringBoot2-x/</id>
    <published>2019-05-17T15:24:15.000Z</published>
    <updated>2019-05-17T15:28:58.226Z</updated>
    
    <content type="html"><![CDATA[<p>SpringBoot与RabbitMQ集成非常简单，不需要做任何的额外设置，只需要两步即可：</p><ul><li>step1：引入相关依赖</li><li>step2：对application.properties进行配置</li></ul><p>首先新建两个项目一个生产者producer一个消费者consumer，项目结构分别如图</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/1.png" alt=""></p><p>这里只做简单的demo演示，所以只用到三个类，实体类Order，消息发送类OrderSender，消息接收类OrderReceiver。</p><h1 id="producer配置编写"><a href="#producer配置编写" class="headerlink" title="producer配置编写"></a>producer配置编写</h1><h2 id="在pom中都引入需要用到的依赖"><a href="#在pom中都引入需要用到的依赖" class="headerlink" title="在pom中都引入需要用到的依赖"></a>在pom中都引入需要用到的依赖</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- rabbitmq依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 工具类依赖包 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.1.26&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="配置producer的application-properties："><a href="#配置producer的application-properties：" class="headerlink" title="配置producer的application.properties："></a>配置producer的application.properties：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># springboot整合rabbitmq基本配置：</span><br><span class="line">spring.rabbitmq.addresses=<span class="number">127.0</span>.0.1:<span class="number">5672</span></span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br><span class="line">spring.rabbitmq.virtual-host=/</span><br><span class="line">spring.rabbitmq.connection-timeout=<span class="number">15000</span></span><br><span class="line"></span><br><span class="line">server.servlet.context-path=/</span><br><span class="line">server.port=<span class="number">8001</span></span><br></pre></td></tr></table></figure><h2 id="新建好订单实体类Order"><a href="#新建好订单实体类Order" class="headerlink" title="新建好订单实体类Order"></a>新建好订单实体类Order</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.herobin.springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8763696299123564381L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String messageId; <span class="comment">//存储消息发送的唯一标识</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">(String id, String name, String messageId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.messageId = messageId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getMessageId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> messageId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessageId</span><span class="params">(String messageId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.messageId = messageId;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在producer包下新建一个订单消息发送类OrderSender"><a href="#在producer包下新建一个订单消息发送类OrderSender" class="headerlink" title="在producer包下新建一个订单消息发送类OrderSender"></a>在producer包下新建一个订单消息发送类OrderSender</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.herobin.springboot.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.herobin.springboot.entity.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderSender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendOrder</span><span class="params">(Order order)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置消息的唯一id</span></span><br><span class="line">CorrelationData correlationData = <span class="keyword">new</span> CorrelationData();</span><br><span class="line">correlationData.setId(order.getMessageId());</span><br><span class="line"><span class="comment">// 这里我们传送的exchange为order-exchange，记得要去RabbitMQ的控制台创建好 配置好喝队列的绑定关系</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"order-exchange"</span>, <span class="comment">//exchange</span></span><br><span class="line"><span class="string">"order.abcd"</span>, <span class="comment">//routingKey </span></span><br><span class="line">order, <span class="comment">//object 消息体内容</span></span><br><span class="line">correlationData ); <span class="comment">//correlationData 消息唯一id</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在控制台创建好我们要用的exchange交换机和queue队列并绑定"><a href="#在控制台创建好我们要用的exchange交换机和queue队列并绑定" class="headerlink" title="在控制台创建好我们要用的exchange交换机和queue队列并绑定"></a>在控制台创建好我们要用的exchange交换机和queue队列并绑定</h2><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/2.png" alt="在这里插入图片描述"></p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/3.png" alt="在这里插入图片描述"></p><p>点击我们的交换机与我们队列绑定</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/4.png" alt="在这里插入图片描述"></p><p>这里<code>.#</code> 和<code>.*</code>是有区别的，前者<code>.#</code>适用与各种配置场景（多点），如order.a.b.c，而后者<code>.*</code>只能配置一个点的，如order.a，order.abc，无法识别order.abc.def这种两个点的场景。</p><p>现在我们可以去测试方法里进行测试了</p><p>启动测试，测试成功。</p><p>去控制台queue队列下我们可以看到已经有了一条队列</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/5.png" alt="在这里插入图片描述"></p><p>说明我们的消息队列发送（生产消息）成功。</p><h1 id="consumer配置编写"><a href="#consumer配置编写" class="headerlink" title="consumer配置编写"></a>consumer配置编写</h1><h2 id="pom和application-properties配置"><a href="#pom和application-properties配置" class="headerlink" title="pom和application.properties配置"></a>pom和application.properties配置</h2><p>consumer的pom用到的和producer都是一样的，application.properties只要将端口号变更一下，再加入消费端的配置就好了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># springboot整合rabbitmq基本配置 </span><br><span class="line">spring.rabbitmq.addresses=<span class="number">127.0</span>.0.1:<span class="number">5672</span></span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br><span class="line">spring.rabbitmq.virtual-host=/</span><br><span class="line">spring.rabbitmq.connection-timeout=<span class="number">15000</span></span><br><span class="line"></span><br><span class="line"># springboot整合rabbitmq消费端配置</span><br><span class="line">spring.rabbitmq.listener.simple.concurrency=<span class="number">5</span></span><br><span class="line">spring.rabbitmq.listener.simple.max-concurrency=<span class="number">10</span></span><br><span class="line">spring.rabbitmq.listener.simple.acknowledge-mode=manual</span><br><span class="line">spring.rabbitmq.listener.simple.prefetch=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">server.servlet.context-path=/</span><br><span class="line">server.port=<span class="number">8002</span></span><br></pre></td></tr></table></figure><h2 id="在消费端的entity下也新建好Order实体类"><a href="#在消费端的entity下也新建好Order实体类" class="headerlink" title="在消费端的entity下也新建好Order实体类"></a>在消费端的entity下也新建好Order实体类</h2><h2 id="编写消费消息类OrderReceiver"><a href="#编写消费消息类OrderReceiver" class="headerlink" title="编写消费消息类OrderReceiver"></a>编写消费消息类OrderReceiver</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.herobin.springboot.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.AmqpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.Headers;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.Payload;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.herobin.springboot.entity.Order;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener</span>(bindings = <span class="meta">@QueueBinding</span>(</span><br><span class="line">value = <span class="meta">@Queue</span>(value = <span class="string">"order-queue"</span>, durable = <span class="string">"true"</span>),</span><br><span class="line">exchange = <span class="meta">@Exchange</span>(name = <span class="string">"order-exchange"</span>, durable = <span class="string">"true"</span>, type = <span class="string">"topic"</span>),</span><br><span class="line">key = <span class="string">"order.*"</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOrderMessage</span><span class="params">(@Payload Order order,</span></span></span><br><span class="line"><span class="function"><span class="params">@Headers Map&lt;String, Object&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">Channel channel)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">// 消费者操作</span></span><br><span class="line">System.err.println(<span class="string">"----------收到消息，开始消费----------"</span>);</span><br><span class="line">System.err.println(<span class="string">"订单ID："</span> + order.getId());</span><br><span class="line">Long deliveryTag = (Long)headers.get(AmqpHeaders.DELIVERY_TAG);</span><br><span class="line"><span class="comment">// ACK 确认签收消息</span></span><br><span class="line">channel.basicAck(deliveryTag, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的<code>@RabbitListener</code>是非常强大的即使我们没有在控制台创建order-exchange和order-queue在执行了启动类之后也会帮我们自动创建好。</p><p>启动我们的consumer程序，清空控制台（方便直观显示消息信息），再去启动producer的测试方法发送消息</p><p>回到consumer的console发现输出了消息</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-03/6.png" alt="在这里插入图片描述"></p><p>至此，实现了rabbitmq整合springboot简单的消息发送与接收。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;SpringBoot与RabbitMQ集成非常简单，不需要做任何的额外设置，只需要两步即可：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;step1：引入相关依赖&lt;/li&gt;
&lt;li&gt;step2：对application.properties进行配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;首先新建两个项
      
    
    </summary>
    
      <category term="MQ" scheme="http://www.herobin.top/categories/MQ/"/>
    
    
      <category term="MQ" scheme="http://www.herobin.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>mac安装启动RabbitMQ</title>
    <link href="http://www.herobin.top/2019/05/17/mac%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8RabbitMQ/"/>
    <id>http://www.herobin.top/2019/05/17/mac安装启动RabbitMQ/</id>
    <published>2019-05-17T15:20:44.000Z</published>
    <updated>2019-05-17T15:22:11.129Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/qq_24095055/article/details/88993147" target="_blank" rel="noopener">mac安装启动RabbitMQ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_24095055/article/details/88993147&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mac安装启动RabbitMQ&lt;/a&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="MQ" scheme="http://www.herobin.top/categories/MQ/"/>
    
    
      <category term="MQ" scheme="http://www.herobin.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>Mac下ActiveMQ的下载与安装</title>
    <link href="http://www.herobin.top/2019/05/17/Mac%E4%B8%8BActiveMQ%E7%9A%84%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%AE%89%E8%A3%85/"/>
    <id>http://www.herobin.top/2019/05/17/Mac下ActiveMQ的下载与安装/</id>
    <published>2019-05-17T15:16:12.000Z</published>
    <updated>2019-05-17T15:18:49.926Z</updated>
    
    <content type="html"><![CDATA[<p>首先在activemq<a href="http://activemq.apache.org" target="_blank" rel="noopener">官网</a>下载压缩包</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-02/1.png" alt=""></p><p>解压后进入/bin/macosx目录下<br>通过<code>./activemq start</code>命令启动<br>控制台出现Starting ActiveMQ Broker…  启动成功 </p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-02/2.png" alt=""></p><p>在浏览器输入 <a href="">127.0.0.1:8161/admin/</a><br>默认的用户名和密码都是admin<br>如图启动成功</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-02/3.png" alt="在这里插入图片描述"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;首先在activemq&lt;a href=&quot;http://activemq.apache.org&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官网&lt;/a&gt;下载压缩包&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent
      
    
    </summary>
    
      <category term="MQ" scheme="http://www.herobin.top/categories/MQ/"/>
    
    
      <category term="MQ" scheme="http://www.herobin.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>mac 打开虚拟机报错 打不开 /dev/vmmon：Broken pipe</title>
    <link href="http://www.herobin.top/2019/05/17/mac%20%E6%89%93%E5%BC%80%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8A%A5%E9%94%99%20%E6%89%93%E4%B8%8D%E5%BC%80%20:dev:vmmon%EF%BC%9ABroken%20pipe/"/>
    <id>http://www.herobin.top/2019/05/17/mac 打开虚拟机报错 打不开 :dev:vmmon：Broken pipe/</id>
    <published>2019-05-17T14:54:01.000Z</published>
    <updated>2019-05-17T15:06:27.981Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-01/1.png" alt=""></p><p>解决办法：<br>去系统偏好设置 ——&gt; 安全性与隐私下的通用中可以看到VMware已被阻止载入，点击允许即可。</p><p><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-01/2.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangbin1995/blog-img/master/imgs/201905/0517-01/1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;解决办法：&lt;br&gt;去系统偏好设置 ——&amp;gt
      
    
    </summary>
    
      <category term="报错" scheme="http://www.herobin.top/categories/%E6%8A%A5%E9%94%99/"/>
    
    
      <category term="报错" scheme="http://www.herobin.top/tags/%E6%8A%A5%E9%94%99/"/>
    
  </entry>
  
  <entry>
    <title>推送github报错“The remote end hung up unexpectedly”解决办法</title>
    <link href="http://www.herobin.top/2019/05/17/%E6%8E%A8%E9%80%81github%E6%8A%A5%E9%94%99%E2%80%9CThe%20remote%20end%20hung%20up%20unexpectedly%E2%80%9D%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>http://www.herobin.top/2019/05/17/推送github报错“The remote end hung up unexpectedly”解决办法/</id>
    <published>2019-05-17T14:46:09.000Z</published>
    <updated>2019-05-17T14:50:38.348Z</updated>
    
    <content type="html"><![CDATA[<p>推送项目到github时先是卡住然后过了很久报错<code>The remote end hung up unexpectedly</code><br>原因是推送的文件太大。</p><p>解决方法：在目录的隐藏文件.git中修改config文件增加如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[http]</span><br><span class="line">postBuffer = <span class="number">524288000</span></span><br></pre></td></tr></table></figure><p>这里是修改提交的缓存为500M。<br>修改之后重新推送即可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;推送项目到github时先是卡住然后过了很久报错&lt;code&gt;The remote end hung up unexpectedly&lt;/code&gt;&lt;br&gt;原因是推送的文件太大。&lt;/p&gt;
&lt;p&gt;解决方法：在目录的隐藏文件.git中修改config文件增加如下代码：&lt;/p&gt;
&lt;f
      
    
    </summary>
    
      <category term="报错" scheme="http://www.herobin.top/categories/%E6%8A%A5%E9%94%99/"/>
    
    
      <category term="报错" scheme="http://www.herobin.top/tags/%E6%8A%A5%E9%94%99/"/>
    
  </entry>
  
  <entry>
    <title>Java面试基础篇</title>
    <link href="http://www.herobin.top/2019/05/16/Java%E9%9D%A2%E8%AF%95%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <id>http://www.herobin.top/2019/05/16/Java面试基础篇/</id>
    <published>2019-05-16T14:13:08.000Z</published>
    <updated>2019-05-16T14:29:27.228Z</updated>
    
    <content type="html"><![CDATA[<p>Java面试基础篇</p><table><thead><tr><th>基础总结</th><th>博客地址</th></tr></thead><tbody><tr><td>Java语言基础常识</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88531257" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>J2EE基础知识</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88687741" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java的强引用、弱引用、软引用、虚引用</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88528214" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java12 新特性</td><td><a href="https://blog.csdn.net/qq_24095055/article/details/88723597" target="_blank" rel="noopener">点击跳转</a></td></tr><tr><td>Java异常详解</td><td></td></tr><tr><td>Java IO 详解</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Java面试基础篇&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;基础总结&lt;/th&gt;
&lt;th&gt;博客地址&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Java语言基础常识&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://blog.
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="java" scheme="http://www.herobin.top/tags/java/"/>
    
      <category term="面试" scheme="http://www.herobin.top/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Java的强引用、弱引用、软引用、虚引用</title>
    <link href="http://www.herobin.top/2019/05/15/Java%E7%9A%84%E5%BC%BA%E5%BC%95%E7%94%A8%E3%80%81%E5%BC%B1%E5%BC%95%E7%94%A8%E3%80%81%E8%BD%AF%E5%BC%95%E7%94%A8%E3%80%81%E8%99%9A%E5%BC%95%E7%94%A8/"/>
    <id>http://www.herobin.top/2019/05/15/Java的强引用、弱引用、软引用、虚引用/</id>
    <published>2019-05-15T14:58:11.000Z</published>
    <updated>2019-05-15T15:14:25.280Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-强引用（StrongReference）"><a href="#1-强引用（StrongReference）" class="headerlink" title="1. 强引用（StrongReference）"></a>1. 强引用（StrongReference）</h1><p>强引用是使用最普遍的引用。如果一个对象具有强引用，那垃圾回收期绝不会回收它。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object o=new Object();   //  强引用</span><br></pre></td></tr></table></figure></p><p>当内存空间不足，Java虚拟机宁愿抛出OutOfMemoryError错误，使程序异常终止，也不会靠随意回收具有强引用的对象来解决内存不足的问题。如果不使用时，要通过如下方式来弱化引用，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o = null;  // 帮助垃圾收集器回收此对象</span><br></pre></td></tr></table></figure></p><p>显式地设置o为null，或超出对象的生命周期范围，则gc认为该对象不存在引用，这时就可以回收这个对象。具体什么时候收集这要取决于gc的算法。</p><p>举例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void test()&#123;</span><br><span class="line">    Object o=new Object();</span><br><span class="line">    // 省略其他操作</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在一个方法的内部有一个强引用，这个引用保存在栈中，而真正的引用内容（Object）保存在堆中。当这个方法运行完成后就会退出方法栈，则引用内容的引用不存在，这个Object会被回收。</p><p>但是如果这个o是全局的变量时，就需要在不用这个对象时赋值为null，因为强引用不会被垃圾回收。</p><p>强引用在实际中有非常重要的用处，举个ArrayList的实现源代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private transient Object[] elementData;</span><br><span class="line">public void clear() &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        // Let gc do its work</span><br><span class="line">        for (int i = 0; i &lt; size; i++)</span><br><span class="line">            elementData[i] = null;</span><br><span class="line">        size = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在ArrayList类中定义了一个私有的变量elementData数组，在调用方法清空数组时可以看到为每个数组内容赋值为null。不同于elementData=null，强引用仍然存在，避免在后续调用 add()等方法添加元素时进行重新的内存分配。使用如clear()方法中释放内存的方法对数组中存放的引用类型特别适用，这样就可以及时释放内存。 </p><h1 id="2、软引用（SoftReference）"><a href="#2、软引用（SoftReference）" class="headerlink" title="2、软引用（SoftReference）"></a>2、软引用（SoftReference）</h1><p>如果一个对象只具有软引用，则内存空间足够，垃圾回收器就不会回收它；如果内存空间不足了，就会回收这些对象的内存。只要垃圾回收器没有回收它，该对象就可以被程序使用。软引用可用来实现内存敏感的高速缓存。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String str=new String(&quot;abc&quot;);                                     // 强引用</span><br><span class="line">SoftReference&lt;String&gt; softRef=new SoftReference&lt;String&gt;(str);     // 软引用</span><br></pre></td></tr></table></figure><p>当内存不足时，等价于：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">If(JVM.内存不足()) &#123;</span><br><span class="line">   str = null;  // 转换为软引用</span><br><span class="line">   System.gc(); // 垃圾回收器进行回收</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p> 软引用在实际中有重要的应用，例如浏览器的后退按钮。按后退时，这个后退时显示的网页内容是重新进行请求还是从缓存中取出呢？这就要看具体的实现策略了。</p><p>（1）如果一个网页在浏览结束时就进行内容的回收，则按后退查看前面浏览过的页面时，需要重新构建</p><p>（2）如果将浏览过的网页存储到内存中会造成内存的大量浪费，甚至会造成内存溢出</p><p>这时候就可以使用软引用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Browser prev = new Browser();               // 获取页面进行浏览</span><br><span class="line">SoftReference sr = new SoftReference(prev); // 浏览完毕后置为软引用        </span><br><span class="line">if(sr.get()!=null)&#123; </span><br><span class="line">    rev = (Browser) sr.get();           // 还没有被回收器回收，直接获取</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    prev = new Browser();               // 由于内存吃紧，所以对软引用的对象回收了</span><br><span class="line">    sr = new SoftReference(prev);       // 重新构建</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就很好的解决了实际的问题。</p><p>软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被垃圾回收器回收，Java虚拟机就会把这个软引用加入到与之关联的引用队列中。</p><h1 id="3、弱引用（WeakReference）"><a href="#3、弱引用（WeakReference）" class="headerlink" title="3、弱引用（WeakReference）"></a>3、弱引用（WeakReference）</h1><p> 弱引用与软引用的区别在于：只具有弱引用的对象拥有更短暂的生命周期。在垃圾回收器线程扫描它所管辖的内存区域的过程中，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存。不过，由于垃圾回收器是一个优先级很低的线程，因此不一定会很快发现那些只具有弱引用的对象。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str=new String(&quot;abc&quot;);    </span><br><span class="line">WeakReference&lt;String&gt; abcWeakRef = new WeakReference&lt;String&gt;(str);</span><br><span class="line">str=null;</span><br></pre></td></tr></table></figure><p>当垃圾回收器进行扫描回收时等价于：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str = null;</span><br><span class="line">System.gc();</span><br></pre></td></tr></table></figure></p><p>如果这个对象是偶尔的使用，并且希望在使用时随时就能获取到，但又不想影响此对象的垃圾收集，那么你应该用 Weak Reference 来记住此对象。   </p><p>下面的代码会让str再次变为一个强引用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String  abc = abcWeakRef.get();</span><br></pre></td></tr></table></figure></p><p>弱引用可以和一个引用队列（ReferenceQueue）联合使用，如果弱引用所引用的对象被垃圾回收，Java虚拟机就会把这个弱引用加入到与之关联的引用队列中。</p><p>当你想引用一个对象，但是这个对象有自己的生命周期，你不想介入这个对象的生命周期，这时候你就是用弱引用。</p><p>这个引用不会在对象的垃圾回收判断中产生任何附加的影响<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">public class ReferenceTest &#123;</span><br><span class="line"></span><br><span class="line">    private static ReferenceQueue&lt;VeryBig&gt; rq = new ReferenceQueue&lt;VeryBig&gt;();</span><br><span class="line"></span><br><span class="line">    public static void checkQueue() &#123;</span><br><span class="line">        Reference&lt;? extends VeryBig&gt; ref = null;</span><br><span class="line">        while ((ref = rq.poll()) != null) &#123;</span><br><span class="line">            if (ref != null) &#123;</span><br><span class="line">                System.out.println(&quot;In queue: &quot;    + ((VeryBigWeakReference) (ref)).id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        int size = 3;</span><br><span class="line">        LinkedList&lt;WeakReference&lt;VeryBig&gt;&gt; weakList = new LinkedList&lt;WeakReference&lt;VeryBig&gt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">            weakList.add(new VeryBigWeakReference(new VeryBig(&quot;Weak &quot; + i), rq));</span><br><span class="line">            System.out.println(&quot;Just created weak: &quot; + weakList.getLast());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.gc(); </span><br><span class="line">        try &#123; // 下面休息几分钟，让上面的垃圾回收线程运行完成</span><br><span class="line">            Thread.currentThread().sleep(6000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        checkQueue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class VeryBig &#123;</span><br><span class="line">    public String id;</span><br><span class="line">    // 占用空间,让线程进行回收</span><br><span class="line">    byte[] b = new byte[2 * 1024];</span><br><span class="line"></span><br><span class="line">    public VeryBig(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void finalize() &#123;</span><br><span class="line">        System.out.println(&quot;Finalizing VeryBig &quot; + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class VeryBigWeakReference extends WeakReference&lt;VeryBig&gt; &#123;</span><br><span class="line">    public String id;</span><br><span class="line"></span><br><span class="line">    public VeryBigWeakReference(VeryBig big, ReferenceQueue&lt;VeryBig&gt; rq) &#123;</span><br><span class="line">        super(big, rq);</span><br><span class="line">        this.id = big.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void finalize() &#123;</span><br><span class="line">        System.out.println(&quot;Finalizing VeryBigWeakReference &quot; + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>最后输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Just created weak: com.javabase.reference.VeryBigWeakReference@1641c0</span><br><span class="line">Just created weak: com.javabase.reference.VeryBigWeakReference@136ab79</span><br><span class="line">Just created weak: com.javabase.reference.VeryBigWeakReference@33c1aa</span><br><span class="line">Finalizing VeryBig Weak 2</span><br><span class="line">Finalizing VeryBig Weak 1</span><br><span class="line">Finalizing VeryBig Weak 0</span><br><span class="line">In queue: Weak 1</span><br><span class="line">In queue: Weak 2</span><br><span class="line">In queue: Weak 0</span><br></pre></td></tr></table></figure></p><h1 id="4、虚引用（PhantomReference）"><a href="#4、虚引用（PhantomReference）" class="headerlink" title="4、虚引用（PhantomReference）"></a>4、虚引用（PhantomReference）</h1><p>“虚引用”顾名思义，就是形同虚设，与其他几种引用都不同，虚引用并不会决定对象的生命周期。如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收器回收。</p><p>虚引用主要用来跟踪对象被垃圾回收器回收的活动。虚引用与软引用和弱引用的一个区别在于：虚引用必须和引用队列 （ReferenceQueue）联合使用。当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，就会在回收对象的内存之前，把这个虚引用加入到与之 关联的引用队列中。</p><h1 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h1><p>java4种引用的级别由高到低依次为：<br><strong><font color="red">强引用 &gt; 软引用 &gt; 弱引用 &gt; 虚引用</font></strong><br>通过图来看一下他们之间在垃圾回收时的区别：<br><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/uploads/190515java1/1.png" alt="在这里插入图片描述"><br>当垃圾回收器回收时，某些对象会被回收，某些不会被回收。垃圾回收器会从根对象Object来标记存活的对象，然后将某些不可达的对象和一些引用的对象进行回收，如果对这方面不是很了解，可以参考如下的文章：</p><p>通过表格来说明一下，如下：<br><img src="https://raw.githubusercontent.com/zhangbin1995/blog-img/master/uploads/190515java1/2.png" alt="在这里插入图片描述"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-强引用（StrongReference）&quot;&gt;&lt;a href=&quot;#1-强引用（StrongReference）&quot; class=&quot;headerlink&quot; title=&quot;1. 强引用（StrongReference）&quot;&gt;&lt;/a&gt;1. 强引用（StrongRefere
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="java" scheme="http://www.herobin.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Guns集成dubbo分布式开发环境搭建</title>
    <link href="http://www.herobin.top/2019/03/04/Guns%E9%9B%86%E6%88%90dubbo%E5%88%86%E5%B8%83%E5%BC%8F%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>http://www.herobin.top/2019/03/04/Guns集成dubbo分布式开发环境搭建/</id>
    <published>2019-03-04T05:20:37.000Z</published>
    <updated>2019-05-15T14:53:50.410Z</updated>
    
    <content type="html"><![CDATA[<p>更多文章欢迎访问个人博客 <a href="http://www.herobin.top">www.herobin.top</a></p><p>首先项目是基于开源软件Guns为基础的。</p><p>码云地址：<a href="https://gitee.com/stylefeng/guns" target="_blank" rel="noopener">https://gitee.com/stylefeng/guns</a></p><p>官网介绍如下：Guns基于Spring Boot 2，致力于做更简洁的后台管理系统，完美整合springmvc + shiro + mybatis-plus + beetl，Guns项目代码简洁，注释丰富，上手容易，同时Guns包含许多基础模块(用户管理，角色管理，部门管理，字典管理等10个模块)，可以直接作为一个后台管理系统的脚手架！同时提供spring cloud版本！</p><p>这里我们使用的不是最新版本，而是比较方便集成dubbo进行分布式开发的一个版本，资料和本博客的项目源码在文章末尾的github中。</p><p>将压缩包在我们理想的目录下解压出来。</p><p><img src="/uploads/190304java1/1.png" alt=""></p><p>首先我们使用guns-rest/db/guns-rest.sql语句创建guns-rest数据库。</p><p><img src="/uploads/190304java1/2.png" alt=""></p><p>去yml中将数据库信息改为本机信息，启动GunsRestApplication，发现报错缺少log4j，在pom中将其引入。</p><p><img src="/uploads/190304java1/3.png" alt=""></p><p>题外话：我们使用开源软件的时候，如果一个版本使用的很好就不要老换，容易出现问题，如维护的人不多导致提交不规范等，可能会使软件变得不再好用。</p><p>上面的问题我们在rest的pom中加上依赖(去maven repository中找就好)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>再次运行发现还有报错MybatisPlusException，这里是因为数据库信息中使用了一个zeroDateTimeBehavior，这里我们将它换成serverTimezone就好了。</p><p><img src="/uploads/190304java1/4.png" alt=""></p><p>再次启动，运行成功。</p><p>这时我们访问rest提供的验证接口：<a href="http://localhost/auth?userName=admin&amp;password=admin" target="_blank" rel="noopener">http://localhost/auth?userName=admin&amp;password=admin</a> </p><p><img src="/uploads/190304java1/5.png" alt=""></p><p>如图，成功返回了token和随机密钥，也说明了我们的guns环境搭建成功了。</p><p>这里我们添加模块可以直接在项目上new module，也可以直接拷贝guns-rest然后改名即可，这里推荐第二种拷贝的方式。</p><p>我们通过copy rest模块新建一个模块guns-gateway，记住要将他添加到总工程的pom中。</p><p><img src="/uploads/190304java1/6.png" alt=""></p><p>在gateway的pom中将artifactId改为正确的名称。</p><p><img src="/uploads/190304java1/7.png" alt=""></p><p>这里会发现我们的gateway模块后面跟着一个guns-rest(1)，这是因为我们从rest拷贝过来的名字默认是rest(1)，去项目的project structure中修改掉即可。</p><p><img src="/uploads/190304java1/8.png" alt=""></p><p>启动一下gateway，启动成功了，再次访问auth接口，还是成功的。</p><p>接下来我们在Guns中集成dubbo。</p><p>首先将dubbo和zookeeper的依赖包拷贝进来。</p><p><img src="/uploads/190304java1/9.png" alt=""></p><p>在yml中配置dubbo信息：</p><p><img src="/uploads/190304java1/10.png" alt=""></p><p>启动类上开启dubbo注解：</p><p><img src="/uploads/190304java1/11.png" alt=""></p><p>然后我们编写一个模拟验证登录状态的服务接口以及他的实现类并通过@Service将它暴露给dubbo。</p><p><img src="/uploads/190304java1/12.png" alt=""></p><p>这样dubbo的一个基本环境就已经完成了。</p><p>将zookeeper启动，再启动我们的项目，会在zookeeper的日志中发现注册了新的服务，至此，集成dubbo成功。</p><p>再次执行auth接口，一切正常。</p><p>这里我们可以发现有一个问题，我们的模块中的接口和实现类都是一对一的，可是每个模块又要有其他模块的接口，这样接口的冗余会非常高，这样我们可以再单独建一个子工程，他的作用就是承载我们的业务接口以及各个模块中需要的实体类。<br>这样接口我们只写一遍，所有的工程就都可以共享了。</p><p>我们拷贝guns-core新命名为guns-api，将用不到的target删掉。<br>在父项目的pom中将它添加进去，再到project structure中将它改好名字，还要改好它自身的pom里的配置。<br>将原来的模块都删掉。</p><p><img src="/uploads/190304java1/13.png" alt=""></p><p>新建我们自己的模块，包名也可以改为我们想要的。然后就可以将我们在gateway中编写的UserAPI接口拷贝过来。</p><p><img src="/uploads/190304java1/13.1.png" alt=""></p><p>然后在gateway中继承一下api模块，就可以直接使用里面的接口了。</p><p><img src="/uploads/190304java1/14.png" alt=""></p><p>这样就可以将我们gateway里面的UserAPI接口删掉了，会自动继承我们写在api里的UserAPI。<br>注意要将我们的api模块放到maven库中，才能读取的到。</p><p><img src="/uploads/190304java1/15.png" alt=""></p><p>不要忘了在api的pom中将名字由core改为api。</p><p><img src="/uploads/190304java1/16.png" alt=""></p><p>再点击maven中api模块的Lifecycle中的install就可以安装api到maven中了，这样gateway里就能读到api里的接口了。</p><p><img src="/uploads/190304java1/17.png" alt=""></p><p>不要忘了去父节点中引入api包。</p><p><img src="/uploads/190304java1/18.png" alt=""></p><p>这时我们可以看到gateway中UserImpl引用的UserAPI接口就是来自api模块中的了。</p><p><img src="/uploads/190304java1/19.png" alt=""></p><p>以后将所有需要暴露的接口都放在api中就好了。</p><p>这样开发的架子就已经搭建好了。</p><p>项目github地址：<a href="https://github.com/zhangbin1995/guns.git" target="_blank" rel="noopener">https://github.com/zhangbin1995/guns.git</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;更多文章欢迎访问个人博客 &lt;a href=&quot;http://www.herobin.top&quot;&gt;www.herobin.top&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先项目是基于开源软件Guns为基础的。&lt;/p&gt;
&lt;p&gt;码云地址：&lt;a href=&quot;https://gitee.com/styl
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="java" scheme="http://www.herobin.top/tags/java/"/>
    
      <category term="springboot" scheme="http://www.herobin.top/tags/springboot/"/>
    
      <category term="dubbo" scheme="http://www.herobin.top/tags/dubbo/"/>
    
      <category term="Guns" scheme="http://www.herobin.top/tags/Guns/"/>
    
  </entry>
  
  <entry>
    <title>springboot集成zookeeper注册中心</title>
    <link href="http://www.herobin.top/2019/03/03/springboot%E9%9B%86%E6%88%90zookeeper%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"/>
    <id>http://www.herobin.top/2019/03/03/springboot集成zookeeper注册中心/</id>
    <published>2019-03-03T08:09:55.000Z</published>
    <updated>2019-05-15T14:50:31.288Z</updated>
    
    <content type="html"><![CDATA[<p>更多文章欢迎访问个人博客 <a href="http://www.herobin.top">www.herobin.top</a></p><p>前面的博客我们配置了springboot集成dubbo开发环境搭建，这里我们在之前的基础上集成zookeeper注册中心。</p><p>首先不要忘记在consumer和provider的pom中引入zookeeper的依赖</p><p><img src="/uploads/190303java4/1.png" alt=""></p><p>修改配置文件，由无注册中心的改为zookeeper注册中心的</p><p><img src="/uploads/190303java4/2.png" alt=""></p><p>这时启动我们项目就可以将这个服务注册到zookeeper上了，可以从zookeeper日志上看出。</p><p>去consumer消费者中填写注册中心地址</p><p><img src="/uploads/190303java4/3.png" alt=""></p><p>修改消费者接口将原来的直连提供者方式改为zookeeper配置。</p><p><img src="/uploads/190303java4/4.png" alt=""></p><p>启动consumer模块，得到目标输出，springboot配置dubbo成功。</p><p><img src="/uploads/190303java4/5.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;更多文章欢迎访问个人博客 &lt;a href=&quot;http://www.herobin.top&quot;&gt;www.herobin.top&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;前面的博客我们配置了springboot集成dubbo开发环境搭建，这里我们在之前的基础上集成zookeeper注册中心。&lt;/p
      
    
    </summary>
    
      <category term="java" scheme="http://www.herobin.top/categories/java/"/>
    
    
      <category term="java" scheme="http://www.herobin.top/tags/java/"/>
    
      <category term="springboot" scheme="http://www.herobin.top/tags/springboot/"/>
    
      <category term="dubbo" scheme="http://www.herobin.top/tags/dubbo/"/>
    
      <category term="zookeeper" scheme="http://www.herobin.top/tags/zookeeper/"/>
    
  </entry>
  
</feed>
